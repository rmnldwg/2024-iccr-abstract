schema: '2.0'
stages:
  filter:
    cmd: "lyscripts data filter data/joined.csv data/filtered.csv --include-subsites
      C01 C02 C03 C04 C05 C06 C09 C10\n"
    deps:
    - path: data/joined.csv
      hash: md5
      md5: 711468c4027e6221a49568d80635e260
      size: 934594
    outs:
    - path: data/filtered.csv
      hash: md5
      md5: 611103c49a8a482b7302339fdebf0173
      size: 823891
  join:
    cmd: "lyscripts data join --inputs data/2021-usz-oropharynx.csv data/2021-clb-oropharynx.csv
      data/2023-clb-multisite.csv data/2023-isb-multisite.csv data/2023-hvh-oropharynx.csv
      --output data/joined.csv\n"
    deps:
    - path: data/2021-clb-oropharynx.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: data/2021-usz-oropharynx.csv
      hash: md5
      md5: 1b949c74081ac4b6224186ebbb9c90df
      size: 159482
    - path: data/2023-clb-multisite.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: data/2023-hvh-oropharynx.csv
      hash: md5
      md5: a5be2bcb32619f901c48bd1d8a7bae8d
      size: 82567
    - path: data/2023-isb-multisite.csv
      hash: md5
      md5: 6135ac91c08b7518372488fb2e0f9b69
      size: 204322
    outs:
    - path: data/joined.csv
      hash: md5
      md5: 711468c4027e6221a49568d80635e260
      size: 934594
  enhance:
    cmd: "lyscripts data enhance data/filtered.csv data/enhanced.csv --params _variables.yml\n"
    deps:
    - path: data/filtered.csv
      hash: md5
      md5: 611103c49a8a482b7302339fdebf0173
      size: 823891
    params:
      _variables.yml:
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
    outs:
    - path: data/enhanced.csv
      hash: md5
      md5: 8ed98ad0206f0114124a8b7da30961c5
      size: 997595
  plot_prevalence_by_subsite:
    cmd: "python scripts/prevalence_by_subsite.py --input data/enhanced.csv --params
      _variables.yml --output figures/prevalence_by_subsite.svg\n"
    deps:
    - path: data/enhanced.csv
      hash: md5
      md5: 8ed98ad0206f0114124a8b7da30961c5
      size: 997595
    - path: scripts/prevalence_by_subsite.py
      hash: md5
      md5: a026ed2a619abc3472ed5f64ff6a2c59
      size: 4005
    params:
      _variables.yml:
        barplot_kwargs:
          width: 0.9
          zorder: 2
    outs:
    - path: figures/prevalence_by_subsite.svg
      hash: md5
      md5: 09951f585e46d4626302d31b7b3b951d
      size: 43272
  write_num_patients:
    cmd: "python scripts/write_num_patients.py --input data/enhanced.csv --output
      _variables.yml\n"
    deps:
    - path: scripts/write_num_patients.py
      hash: md5
      md5: f1d83d9cd9eee0b28fb0764f5daf569e
      size: 1061
  filter_oropharynx_and_oral_cavity:
    cmd: "lyscripts data filter data/joined.csv data/filtered.csv --include-subsites
      C01 C02 C03 C04 C05 C06 C09 C10\n"
    deps:
    - path: data/joined.csv
      hash: md5
      md5: 711468c4027e6221a49568d80635e260
      size: 934594
    outs:
    - path: data/filtered.csv
      hash: md5
      md5: 611103c49a8a482b7302339fdebf0173
      size: 823891
  filter_oropharynx:
    cmd: "lyscripts data filter data/enhanced.csv data/oropharynx.csv --include-subsites
      C01 C09 C10\n"
    deps:
    - path: data/enhanced.csv
      hash: md5
      md5: 8ed98ad0206f0114124a8b7da30961c5
      size: 997595
    outs:
    - path: data/oropharynx.csv
      hash: md5
      md5: b8e927c72b59c26e0fe66022d0494a96
      size: 658630
  filter_oral_cavity:
    cmd: "lyscripts data filter data/enhanced.csv data/oral_cavity.csv --include-subsites
      C02 C03 C04 C05 C06\n"
    deps:
    - path: data/enhanced.csv
      hash: md5
      md5: 8ed98ad0206f0114124a8b7da30961c5
      size: 997595
    outs:
    - path: data/oral_cavity.csv
      hash: md5
      md5: 3428c64a81e8633769c3114000a9b07b
      size: 346037
  sample_from_oropharynx:
    cmd: "lyscripts sample data/oropharynx.csv models/oropharynx.hdf5 --params _variables.yml
      --modalities max_llh --plots figures/sample_from_oropharynx --pools 0 --seed
      42\n"
    deps:
    - path: data/oropharynx.csv
      hash: md5
      md5: b8e927c72b59c26e0fe66022d0494a96
      size: 658630
    params:
      _variables.yml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
          lnl:
            I:
            - II
            II:
            - III
            III:
            - IV
            IV: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: Unilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 20
          thin_by: 10
          kwargs:
            max_steps: 20000
            check_interval: 50
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: figures/sample_from_oropharynx/accept_rates.csv
      hash: md5
      md5: 2ab500de6f503299c73f0a0ea62fab28
      size: 996
    - path: figures/sample_from_oropharynx/acor_times.csv
      hash: md5
      md5: adba9e138d1202b971b0b12db9be548a
      size: 1027
    - path: models/oropharynx.hdf5
      hash: md5
      md5: d44f2bfe295ab8e8167ef4a718ff37a4
      size: 1604832
  sample_from_oral_cavity:
    cmd: "lyscripts sample data/oral_cavity.csv models/oral_cavity.hdf5 --params _variables.yml
      --modalities max_llh --plots figures/sample_from_oral_cavity --pools 0 --seed
      42\n"
    deps:
    - path: data/oral_cavity.csv
      hash: md5
      md5: 3428c64a81e8633769c3114000a9b07b
      size: 346037
    params:
      _variables.yml:
        graph:
          tumor:
            primary:
            - I
            - II
            - III
            - IV
          lnl:
            I:
            - II
            II:
            - III
            III:
            - IV
            IV: []
        model:
          first_binom_prob: 0.3
          max_t: 10
          t_stages:
          - early
          - late
          class: Unilateral
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
        sampling:
          walkers_per_dim: 20
          burnin: 1000
          nsteps: 20
          thin_by: 10
          kwargs:
            max_steps: 20000
            check_interval: 50
            trust_threshold: 30.0
            rel_acor_threshold: 0.075
    outs:
    - path: figures/sample_from_oral_cavity/accept_rates.csv
      hash: md5
      md5: cc250dc25bf719e81a6013afd74da0de
      size: 1207
    - path: figures/sample_from_oral_cavity/acor_times.csv
      hash: md5
      md5: a774ab62cda190fa559d406c86071a70
      size: 1245
    - path: models/oral_cavity.hdf5
      hash: md5
      md5: 0c506ef22449cc318cf102103096936a
      size: 1604832
  render_pdf:
    cmd: "quarto render content/manuscript.qmd --to iccr-pdf\n"
    deps:
    - path: _extensions
      hash: md5
      md5: 2fc478636b20635d27d084b01c3ec092.dir
      size: 3885
      nfiles: 9
    - path: content/manuscript.qmd
      hash: md5
      md5: a0397d6b8313eef117e659d3703292b6
      size: 19799
    - path: figures
      hash: md5
      md5: abedf829ed40e181fa3451397c257494.dir
      size: 47876
      nfiles: 8
    - path: static
      hash: md5
      md5: 7f7cf86e0a573f41b69c4becfa4c1e19.dir
      size: 208359
      nfiles: 2
    params:
      _variables.yml:
        model.first_binom_prob: 0.3
        model.max_t: 10
        num_patients: 1242
    outs:
    - path: content/manuscript.pdf
      hash: md5
      md5: 38e6d3316fc5d66beccbf2b7f826d08c
      size: 149190
