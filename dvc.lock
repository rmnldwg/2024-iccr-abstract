schema: '2.0'
stages:
  filter:
    cmd: "lyscripts data filter data/joined.csv data/filtered.csv --include-subsites
      C01 C02 C03 C04 C05 C06 C09 C10\n"
    deps:
    - path: data/joined.csv
      hash: md5
      md5: 711468c4027e6221a49568d80635e260
      size: 934594
    outs:
    - path: data/filtered.csv
      hash: md5
      md5: 611103c49a8a482b7302339fdebf0173
      size: 823891
  join:
    cmd: "lyscripts data join --inputs data/2021-usz-oropharynx.csv data/2021-clb-oropharynx.csv
      data/2023-clb-multisite.csv data/2023-isb-multisite.csv data/2023-hvh-oropharynx.csv
      --output data/joined.csv\n"
    deps:
    - path: data/2021-clb-oropharynx.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: data/2021-usz-oropharynx.csv
      hash: md5
      md5: 1b949c74081ac4b6224186ebbb9c90df
      size: 159482
    - path: data/2023-clb-multisite.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: data/2023-hvh-oropharynx.csv
      hash: md5
      md5: a5be2bcb32619f901c48bd1d8a7bae8d
      size: 82567
    - path: data/2023-isb-multisite.csv
      hash: md5
      md5: 6135ac91c08b7518372488fb2e0f9b69
      size: 204322
    outs:
    - path: data/joined.csv
      hash: md5
      md5: 711468c4027e6221a49568d80635e260
      size: 934594
  enhance:
    cmd: "lyscripts data enhance data/filtered.csv data/enhanced.csv --params _variables.yml\n"
    deps:
    - path: data/filtered.csv
      hash: md5
      md5: 611103c49a8a482b7302339fdebf0173
      size: 823891
    params:
      _variables.yml:
        modalities:
          CT:
          - 0.76
          - 0.81
          FNA:
          - 0.98
          - 0.8
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          diagnostic_consensus:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
    outs:
    - path: data/enhanced.csv
      hash: md5
      md5: 8ed98ad0206f0114124a8b7da30961c5
      size: 997595
  plot_prevalence_by_subsite:
    cmd: "python scripts/prevalence_by_subsite.py --input data/enhanced.csv --params
      _variables.yml --output figures/prevalence_by_subsite.svg\n"
    deps:
    - path: data/enhanced.csv
      hash: md5
      md5: 8ed98ad0206f0114124a8b7da30961c5
      size: 997595
    - path: scripts/prevalence_by_subsite.py
      hash: md5
      md5: 5f8229064c97508ee023e9145d2672ff
      size: 2765
    params:
      _variables.yml:
        barplot_kwargs:
          width: 0.9
          zorder: 2
        icd_code_map:
          C01: base of tongue
          C02: tongue, other
          C03: gum
          C04: floor of mouth
          C05: palate
          C06: mouth, other
          C09: tonsil
          C10: oropharynx, other
    outs:
    - path: figures/prevalence_by_subsite.svg
      hash: md5
      md5: 30400a92b1479c0a70e7e69d84a9e673
      size: 46350
  write_num_patients:
    cmd: "python scripts/write_num_patients.py --input data/enhanced.csv --output
      _variables.yml\n"
    deps:
    - path: scripts/write_num_patients.py
      hash: md5
      md5: f096621524dd445e6df56ba2d8c3bc19
      size: 1422
    params:
      _variables.yml:
        icd_code_map:
          C01: base of tongue
          C02: tongue, other
          C03: gum
          C04: floor of mouth
          C05: palate
          C06: mouth, other
          C09: tonsil
          C10: oropharynx, other
  filter_oropharynx_and_oral_cavity:
    cmd: "lyscripts data filter data/joined.csv data/filtered.csv --include-subsites
      C01 C02 C03 C04 C05 C06 C09 C10\n"
    deps:
    - path: data/joined.csv
      hash: md5
      md5: 711468c4027e6221a49568d80635e260
      size: 934594
    outs:
    - path: data/filtered.csv
      hash: md5
      md5: 611103c49a8a482b7302339fdebf0173
      size: 823891
  filter_oropharynx:
    cmd: "lyscripts data filter data/enhanced.csv data/oropharynx.csv --include-subsites
      C01 C09 C10\n"
    deps:
    - path: data/enhanced.csv
      hash: md5
      md5: 8ed98ad0206f0114124a8b7da30961c5
      size: 997595
    outs:
    - path: data/oropharynx.csv
      hash: md5
      md5: b8e927c72b59c26e0fe66022d0494a96
      size: 658630
  filter_oral_cavity:
    cmd: "lyscripts data filter data/enhanced.csv data/oral_cavity.csv --include-subsites
      C02 C03 C04 C05 C06\n"
    deps:
    - path: data/enhanced.csv
      hash: md5
      md5: 8ed98ad0206f0114124a8b7da30961c5
      size: 997595
    outs:
    - path: data/oral_cavity.csv
      hash: md5
      md5: 3428c64a81e8633769c3114000a9b07b
      size: 346037
  sample_from_oropharynx:
    cmd: "lyscripts sample data/oropharynx.csv models/oropharynx.hdf5 --params _variables.yml
      --modalities max_llh --plots figures/sample_from_oropharynx --pools 0 --seed
      42\n"
    deps:
    - path: data/oropharynx.csv
      hash: md5
      md5: b8e927c72b59c26e0fe66022d0494a96
      size: 658630
    params:
      _variables.yml:
        graph:
          lnl:
            I:
            - II
            II:
            - III
            III:
            - IV
            IV: []
          tumor:
            primary:
            - I
            - II
            - III
            - IV
        model:
          class: Unilateral
          first_binom_prob: 0.3
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
          max_t: 10
          t_stages:
          - all
        sampling:
          burnin: 1000
          kwargs:
            check_interval: 50
            max_steps: 20000
            rel_acor_threshold: 0.075
            trust_threshold: 30.0
          nsteps: 20
          thin_by: 10
          walkers_per_dim: 20
    outs:
    - path: figures/sample_from_oropharynx/accept_rates.csv
      hash: md5
      md5: 9610d43ea98a29043f5b54fc12e1390f
      size: 504
    - path: figures/sample_from_oropharynx/acor_times.csv
      hash: md5
      md5: 073b38c669c95603c9905129ebd022d0
      size: 482
    - path: models/oropharynx.hdf5
      hash: md5
      md5: b5b17c24c6427735d181e387cd62443b
      size: 1454016
  sample_from_oral_cavity:
    cmd: "lyscripts sample data/oral_cavity.csv models/oral_cavity.hdf5 --params _variables.yml
      --modalities max_llh --plots figures/sample_from_oral_cavity --pools 0 --seed
      42\n"
    deps:
    - path: data/oral_cavity.csv
      hash: md5
      md5: 3428c64a81e8633769c3114000a9b07b
      size: 346037
    params:
      _variables.yml:
        graph:
          lnl:
            I:
            - II
            II:
            - III
            III:
            - IV
            IV: []
          tumor:
            primary:
            - I
            - II
            - III
            - IV
        model:
          class: Unilateral
          first_binom_prob: 0.3
          kwargs:
            base_symmetric: false
            trans_symmetric: true
            use_mixing: true
          max_t: 10
          t_stages:
          - all
        sampling:
          burnin: 1000
          kwargs:
            check_interval: 50
            max_steps: 20000
            rel_acor_threshold: 0.075
            trust_threshold: 30.0
          nsteps: 20
          thin_by: 10
          walkers_per_dim: 20
    outs:
    - path: figures/sample_from_oral_cavity/accept_rates.csv
      hash: md5
      md5: 9610d43ea98a29043f5b54fc12e1390f
      size: 504
    - path: figures/sample_from_oral_cavity/acor_times.csv
      hash: md5
      md5: 073b38c669c95603c9905129ebd022d0
      size: 482
    - path: models/oral_cavity.hdf5
      hash: md5
      md5: b5b17c24c6427735d181e387cd62443b
      size: 1454016
  render_pdf:
    cmd: "quarto render\n"
    deps:
    - path: _extensions
      hash: md5
      md5: 2fc478636b20635d27d084b01c3ec092.dir
      size: 3885
      nfiles: 9
    - path: content/manuscript.qmd
      hash: md5
      md5: 236fb99fc44b8325d5ff5bbc14becce1
      size: 19034
    - path: figures
      hash: md5
      md5: 7a0100a57029da3ce6a6a163e238f233.dir
      size: 215327
      nfiles: 11
    - path: models
      hash: md5
      md5: e8e7fdd5dbb764ea9898f529f3aef46d.dir
      size: 63333481
      nfiles: 4
    - path: static
      hash: md5
      md5: 121ab34f0469b57010712594682141a0.dir
      size: 252522
      nfiles: 1
    params:
      _variables.yml:
        model.first_binom_prob: 0.3
        model.max_t: 10
        num_patients:
          C01: 212
          C02: 158
          C03: 45
          C04: 99
          C05: 61
          C06: 46
          C09: 452
          C10: 169
          total: 1242
    outs:
    - path: _site/
      hash: md5
      md5: c7e500dca168005f24dfb735cdb690aa.dir
      size: 1841940
      nfiles: 22
  mixture_model_em_sampling:
    cmd: "python scripts/mixture_model_sampling.py --input data/enhanced.csv --model
      models/mixture.hdf5 --figure figures/mixture_history.svg --params _variables.yml\n"
    deps:
    - path: data/enhanced.csv
      hash: md5
      md5: 8ed98ad0206f0114124a8b7da30961c5
      size: 997595
    - path: scripts/mixture_model_sampling.py
      hash: md5
      md5: 303cd47bf17592e4edade6e056687edc
      size: 2998
    params:
      _variables.yml:
        mixture_model:
          em_config:
            convergence:
              criterion: default
              default:
                lookback_period: 4
                threshold: 0.015
            e_step:
              nburnin: 50
              nsteps: 30
              sampler: SIMPLE
              show_progress: true
              walkers_per_dim: 20
            m_step:
              minimize_method: SLSQP
            max_steps: 20
            method: INVERTED
            verbose: false
          mcmc_config:
            sampler: SIMPLE
            sampling_params:
              nburnin: 600
              nsteps: 1000
              walkers_per_dim: 20
          num_clusters: 2
    outs:
    - path: figures/mixture_history.svg
      hash: md5
      md5: 7e6180bc8482164e9114dc6341cedc2c
      size: 69287
    - path: models/mixture.hdf5
      hash: md5
      md5: 2aeb04cd4e3694d8e6fc2364f6ce160a
      size: 60425400
  plot_cluster_assignments:
    cmd: "python scripts/plot_cluster_assignments.py --model models/mixture.hdf5 --output
      figures/cluster_assignments.svg --params _variables.yml\n"
    deps:
    - path: models/mixture.hdf5
      hash: md5
      md5: 2aeb04cd4e3694d8e6fc2364f6ce160a
      size: 60425400
    - path: scripts/plot_cluster_assignments.py
      hash: md5
      md5: 0d7327277a6784ce179a07cef06c7a53
      size: 3420
    params:
      _variables.yml:
        num_patients:
          C01: 212
          C02: 158
          C03: 45
          C04: 99
          C05: 61
          C06: 46
          C09: 452
          C10: 169
          total: 1242
    outs:
    - path: figures/cluster_assignments.svg
      hash: md5
      md5: a55c1c66b19644fe2f2418a4ed470d84
      size: 38099
